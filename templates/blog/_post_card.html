{% load static %}
<article class="tweet-card p-3" id="post-{{ post.slug }}" data-post-slug="{{ post.slug }}">
  <div class="d-flex gap-3">
    <a href="/accounts/profile/">
      {% if post.author.profile and post.author.profile.avatar %}
        <img class="avatar" src="{{ post.author.profile.avatar.url }}" alt="avatar">
      {% else %}
        <img class="avatar" src="{% static 'file-icons/file.png' %}" alt="avatar">
      {% endif %}
    </a>
    <div class="flex-grow-1">
      <div class="d-flex align-items-center flex-wrap">
        <a href="/blog/post/{{ post.slug }}/" class="text-decoration-none text-dark display-name me-1">{{ post.author.username }}</a>
        <span class="handle">@{{ post.author.username|lower }}</span>
        <span class="dot"></span>
        <span class="handle">{{ post.created_at|timesince }} ago</span>
      </div>
      {% if post.title %}
        <div class="fw-bold mt-1">{{ post.title }}</div>
      {% endif %}
      <div class="tweet-content mt-1">
        {% if post.type == 'poll' %}
          <div class="small text-secondary">Poll • {{ post.poll_options.count }} options</div>
          <ul class="small text-secondary mb-2 ps-3">
            {% for opt in post.poll_options.all|slice:':3' %}
              <li>{{ opt.text }}</li>
            {% endfor %}
            {% if post.poll_options.count > 3 %}
              <li>+{{ post.poll_options.count|add:'-3' }} more…</li>
            {% endif %}
          </ul>
        {% else %}
          {{ post.content|striptags|truncatewords:40 }}
        {% endif %}
      </div>

      <div class="d-flex justify-content-between align-items-center tweet-actions mt-2 me-5">
        <a href="/blog/post/{{ post.slug }}/" class="btn tweet-action-btn" title="Open">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/><path d="M3 12h12"/></svg>
        </a>
        <button class="btn tweet-action-btn like-btn" data-like-url="/blog/post/{{ post.slug }}/like-toggle/" title="Like">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg>
          <span class="ms-1 like-count">{{ post.likes_count }}</span>
        </button>
        <a href="/blog/post/{{ post.slug }}/reply/" class="btn tweet-action-btn" title="Reply" hx-get="/blog/post/{{ post.slug }}/reply/" hx-target="#composeModalBody" hx-swap="innerHTML" hx-push-url="false">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          <span class="ms-1 comment-count">{{ post.comments.count }}</span>
        </a>
      </div>
    </div>
    {% if post.type %}
      <div class="text-end">
        {% if post.type == 'article' %}
          <span class="badge text-bg-primary">Article</span>
        {% elif post.type == 'post' %}
          <span class="badge text-bg-success">Post</span>
        {% elif post.type == 'poll' %}
          <span class="badge text-bg-warning">Poll</span>
        {% else %}
          <span class="badge text-bg-secondary">{{ post.type|title }}</span>
        {% endif %}
      </div>
    {% endif %}
  </div>
</article>


